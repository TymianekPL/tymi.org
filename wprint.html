<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>D3673 std::wprint/std::wprintln</title>
     <meta name="description" content="P3673 std::wprint/std::wprintln proposal">
     <meta name="keywords" content="std::wprint,  
std::wprintln, C++, wide character, formatted output, tymi, P3673, D3673">
     <meta name="author" content="tymi">
     <meta property="og:title" content="std::wprint/std::wprintln">
     <style>
          body {
               font-family: Arial, sans-serif;
               line-height: 1.6;
               color: snow;
               background-color: #10101f;
          }

          header {
               display: flex;
               justify-content: space-between;
               font-size: 0.9em;
               border-bottom: 1px solid #000;
               padding-bottom: 5px;
          }

          .title-page {
               text-align: center;
               margin-top: 100px;
          }

          .title-page h1 {
               font-size: 2.5em;
               word-wrap: normal;
          }

          .title-page p {
               font-size: 1.2em;
          }

          .abstract {
               font-weight: bold;
               text-align: center;
               margin-top: 50px;
          }

          blockquote {
               margin: 20px;
               font-style: italic;
          }

          h2 {
               font-size: 1.5em;
               font-weight: bold;
               margin-top: 30px;
          }

          ul {
               margin-left: 20px;
          }

          a {
               color: #deadda;
               text-decoration: none;
          }

          a:hover {
               text-decoration: underline;
          }

          .keyword {
               color: #deadda;
          }

          .var {
               color: #a0d3ff;
          }

          .type {
               color: #10cfa0;
          }

          .func {
               color: #e4e48e;
          }

          .macro {
               color: grey;
          }

          .string {
               color: #ea785f;
          }


          .number {
               color: yellowgreen;
          }

          footer {
               text-align: center;
               margin-top: 50px;
               font-size: 0.9em;
          }

          pre {
               word-wrap: break-word;
               overflow-x: auto;
          }

          header {
               position: sticky;
               top: 0;
               background-color: inherit;
               padding-block: 2.5px;
          }
     </style>
</head>

<body>
     <header>
          <div>Document Number: D3673R0</div>
          <div>Date: <i>16.04.2025</i></div>
     </header>

     <section class="title-page">
          <h1>std::wprint / std::wprintln</h1>
          <p>Document Number: D3673R0</p>
          <p>Date: <i>16.04.2025</i></p>
          <p>Audience: Library Evolution Working Group Incubator (LEWGI, SG18), SG16</p>
          <p>Author(s): Tymi <a href="mailto:tymi.cpp@gmail.com">&lt;tymi.cpp@gmail.com&gt;</a></p>
     </section>

     <section class="abstract">
          <p>Abstract</p>
          <blockquote>
               C++ introduced <code>std::print</code>/<code>std::println</code> in C++23. While most functions support
               wide strings, this particular one lacks the support. This proposal aims to improve that by adding a
               collection of wide string overloads functions for it, accepting <code>std::wformat_string</code>.
          </blockquote>
     </section>

     <h2>Introduction</h2>
     <p>This proposal aims to improve the interface of the printing utilities by extending them with wide string
          versions.</p>
     <p>That will allow for a better integration with systems using wide characters and programs preferring them.</p>

     <h2>Revision History</h2>
     <ul>
          <li>R0: Initial proposal.</li>
     </ul>

     <h2>Motivation and Scope</h2>
     <p>
          C++23 has introduced <code>std::print</code> and <code>std::println</code> function templates, which allow for
          easy and efficient text output to the console. They provide an interface for regular string formats. However,
          they do not provide an interface for wide strings, which are commonly used in Windows systems, as well as in
          specialised systems that work with non-standard encoding. I aim to improve that, by adding an interface to
          make it accessible.
     </p>

     <h2>Impact on the Standard</h2>
     <h3>New Functionality</h3>
     <p>
          Implementing this proposal means adding new overloads for a function template to the standard library.
     </p>

     <h2>Technical Specification</h2>
     <pre>
<span class="keyword">namespace</span> <span class="type">std</span>
{
     <span class="keyword">template</span> <span class="macro">&lt;</span><span class="keyword">typename...</span> <span class="type">Args</span><span class="macro">&gt;</span>
     <span class="keyword">void</span> <span class="func">print</span>(<span class="type">wformat_string</span><span class="macro">&lt;</span><span class="type">Args...</span><span class="macro">&gt;</span> <span class="var">fmt</span>, <span class="type">Args&&</span>... <span class="var">args</span>);</pre>

     <pre>
     <span class="keyword">template</span> <span class="macro">&lt;</span><span class="keyword">typename...</span> <span class="type">Args</span><span class="macro">&gt;</span>
     <span class="keyword">void</span> <span class="func">print</span>(<span class="type">FILE</span>* <span class="var">stream</span>, <span class="type">wformat_string</span><span class="macro">&lt;</span><span class="type">Args...</span><span class="macro">&gt;</span> <span class="var">fmt</span>, <span class="type">Args&&</span>... <span class="var">args</span>);
</pre>

     <pre>
     <span class="keyword">template</span> <span class="macro">&lt;</span><span class="keyword">typename...</span> <span class="type">Args</span><span class="macro">&gt;</span>
     <span class="keyword">void</span> <span class="func">println</span>(<span class="type">wformat_string</span><span class="macro">&lt;</span><span class="type">Args...</span><span class="macro">&gt;</span> <span class="var">fmt</span>, <span class="type">Args&&</span>... <span class="var">args</span>);
</pre>
     <pre>
     <span class="keyword">template</span> <span class="macro">&lt;</span><span class="keyword">typename...</span> <span class="type">Args</span><span class="macro">&gt;</span>
     <span class="keyword">void</span> <span class="func">println</span>();
</pre>
     <pre>
     <span class="keyword">template</span> <span class="macro">&lt;</span><span class="keyword">typename...</span> <span class="type">Args</span><span class="macro">&gt;</span>
     <span class="keyword">void</span> <span class="func">println</span>(<span class="type">FILE</span>* <span class="var">stream</span>, <span class="type">wformat_string</span><span class="macro">&lt;</span><span class="type">Args...</span><span class="macro">&gt;</span> <span class="var">fmt</span>, <span class="type">Args&&</span>... <span class="var">args</span>);
</pre>
     <pre>
     <span class="keyword">template</span> <span class="macro">&lt;</span><span class="keyword">typename...</span> <span class="type">Args</span><span class="macro">&gt;</span>
     <span class="keyword">void</span> <span class="func">println</span>(<span class="type">FILE</span>* <span class="var">stream</span>);
}
</pre>
     <p>
          These are the possible signatures for the functions covered by this proposal.
     </p>

     <h2>Implementation Experience</h2>
     <p>No implementation experience yet, although there is a work in progress project to add those overloads into MSVC, clang and ECPPS.
     </p>

     <h2>Design Decisions</h2>
     <p>
          Some might say adding a separate function for wide string support such as wprint/wprintln would align more with other functions such as printf, cout, etc. Although in my opinion these names are remaments of C, and <code>std::print</code> is closer to <code>std::format</code> which uses the overload convention.
     </p>
     <p>
          There could also exist overloads for other strings (<code>std::basic_format_string &gt;charN_t&lt;</code>), but this proposal does not cover those. Maybe in a future revision or a separate paper.
     </p>

     <h2>References</h2>

     <h2>Appendix A. Examples</h2>
     <p>
          Here are a couple of examples where <code>std::print</code>/<code>std::println</code> wide string overloads could be benefitial.
     </p>
     <h3>WinAPI</h3>
     <pre>
<span class="keyword">int</span> main(<span class="keyword">void</span>)
{
     <span class="type">std</span>::<span class="type">wstring</span> <span class="var">locale</span>{};
     <span class="var">locale</span>.<span class="func">resize</span>(<span class="macro">LOCALE_NAME_MAX_LENGTH</span>);
     <span class="var">locale</span>.<span class="func">resize</span>(<span class="func">GetUserDefaultLocaleName</span>(<span class="var">locale</span>.<span class="func">data</span>(), <span class="var">locale</span>.<span class="func">size</span>()) - <span class="number">1</span>);     

     <span class="type">std</span>::<span class="func">println</span>(<span class="string">L"The System Locale is {}"</span>, <span class="var">locale</span>);
}
</pre>
     <p>
          Expected output:
          <pre>The System Locale is en-GB</pre>
     </p>
     <h3>Unicode characters in paths</h3>
     <pre>
<span class="keyword">void</span> PrintPath(<span class="type">std</span>::<span class="type">filesystem</span>::<span class="type">path</span> <span class="var">path</span>)
{
     <span class="type">std</span>::<span class="func">println</span>(<span class="string">L"Path = {}"</span>, <span class="var">path</span>);
}
     </pre>
</body>

</html>
